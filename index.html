<!doctype html>
<html class="no-js" lang="">
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="https://raw.github.com/Stuk/jszip/master/jszip.js"></script>
<script type="text/javascript" src="jszip.js"></script>
<link media="screen" href="http://code.jquery.com/qunit/qunit-1.14.0.css" type="text/css" rel="stylesheet">
<script type="text/javascript" src="http://code.jquery.com/qunit/qunit-1.14.0.js"></script>
<link href="/try/bootstrap/twitter-bootstrap-v2/docs/assets/css/bootstrap.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jszip-utils.js"></script>
 
<body>
<h1>W3Internal Note</h1>

<h3>Please select your files</h3>
<form action="#" id="download_form">
    <ul>
        <li>
            <label>
                <input type="checkbox" data-url="Gateway_System.xml" checked />
                xml
            </label>
        </li>
        <li>
            <label>
                <input type="checkbox" data-url="" checked />
                json
            </label>
        </li>
        <li>
            <label>
                <input type="checkbox" data-url="/jszip/dist/jszip.js" />
                jszip.js
            </label>
        </li>
        <li>
            <label>
                <input type="checkbox" data-url="/jszip/test/ref/all.zip" />
                all.zip
            </label>
        </li>
    </ul>

    <button type="submit" class="btn btn-primary">pack them !</button>
</form>

<div class="progress hide" id="progress_bar">
    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
    </div>
</div>

<p class="hide" id="result"></p>

<script>
 
var Promise = window.Promise;
if (!Promise) {
    Promise = JSZip.external.Promise;
}

function urlToPromise(url) {
    return new Promise(function(resolve, reject) {
        JSZipUtils.getBinaryContent(url, function (err, data) {
            if(err) {
                reject(err);
            } else {
                resolve(data);
            }
        });
    });
}

var $form = $("#download_form").on("submit", function () {

    resetMessage();

    var zip = new JSZip();

    // find every checked item
    $(this).find(":checked").each(function () {
        var $this = $(this);
        var url = $this.data("url");
        var filename = url.replace(/.*\//g, "");
        zip.file(filename, urlToPromise(url), {binary:true});
    });

    // when everything has been downloaded, we can trigger the dl
    zip.generateAsync({type:"blob"}, function updateCallback(metadata) {
        var msg = "progression : " + metadata.percent.toFixed(2) + " %";
        if(metadata.currentFile) {
            msg += ", current file = " + metadata.currentFile;
        }
        showMessage(msg);
        updatePercent(metadata.percent|0);
    })
    .then(function callback(blob) {

        // see FileSaver.js
        saveAs(blob, "Gateway_System.zip");

        showMessage("done !");
    }, function (e) {
        showError(e);
    });

    return false;
});
</script>
 
 
 
</body>
</html>
